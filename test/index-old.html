<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<script src="CocoonJS.js"></script>
		<script src="CocoonJS_App.js"></script>
		<script src="CocoonJS_App_ForCocoonJS.js"></script>
		<!--<script src="pixi.js"></script>-->
		<script src="phaser.js"></script>
		<script type="text/javascript">
		CocoonJS.App.onLoadInTheWebViewSucceed.addEventListener(function(url){
			//alert(url);
			CocoonJS.App.showTheWebView();
		});
		CocoonJS.App.loadInTheWebView("test.htm");
		</script>
		<script src="axel2.js"></script>
		<script>
		window.onload = function() {
			var scale=window.innerHeight/600;
			var w=window.innerWidth/scale;
			var h=600;
			
			var game = new Phaser.Game(window.innerWidth, window.innerHeight, Phaser.WEBGL, '', { preload: preload, create: create});
			function preload () {
				game.world.setBounds(0,0,w,h);
				game.stage.backgroundColor="#DDDDDD";
				game.load.image('logo', 'images/katyuska2.jpg');
				game.load.image('kat','images/katyuska.jpg');
				game.load.image('naota','images/naota.jpg');
				game.add.sprite(0,0,'');
			}
			function create () {
				game.world.scale.x=scale;
				game.world.scale.y=scale;
				game.world.updateTransform();
				var logo = game.add.sprite(0, 0, 'logo');
			}
			
			function jsonAjax(url,postData)
			{
				log("making request to: ",url);
				var request=new XMLHttpRequest();
				var p=new promise();
				request.addEventListener('load',function(event){
					p.resolve(request);
				});
				request.addEventListener('error',function(error){
					p.reject(error);
				});
				request.setRequestHeader("Content-Type","application/json");
				request.open("POST",url,true);
				request.send(postData);
				return p;
			}
			
			//	\\/%{0}+%{1/string rjust 2 0}00\\/
			jsonAjax(
				"http://gameqa.centerforautism.com/api/CreatePlayer?format=json",
				sprintf('{"gamerName":"JS Test2","birthdate":"'+(new Date(2010,9).toUTCString())+'","deviceIdentifier":"watman!","gender":0}',Date.now(),new Date().getTimezoneOffset()/60)
			).then(function(xhr){
				puts("LOADED!",xhr.responseText);
			},function(err){
				puts("Failed",err);
			});
			// function render()
			// {
			// 	this.renderer.render(this.stage);
			// 	log('rendering!',Date.now());
			// }
		};
		</script>
		<style>
		html, body{margin:0px; padding:0px;}
		</style>
	</head>
	<body>
	</body>
</html>
